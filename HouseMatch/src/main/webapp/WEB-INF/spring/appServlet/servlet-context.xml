<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/aop
    	http://www.springframework.org/schema/aop/spring-aop-3.1.xsd">

    <context:component-scan base-package="ca.ulaval.glo4003.b6.housematch" />
    <annotation-driven />

    <!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources/ 
        directory -->
    <resources
        mapping="/resources/**"
        location="/resources/" />

    <!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
    <beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <beans:property
            name="prefix"
            value="/WEB-INF/views/" />
        <beans:property
            name="suffix"
            value=".jsp" />
    </beans:bean>


    <beans:bean
        id="estateRepositoryFactory"
        class="ca.ulaval.glo4003.b6.housematch.persistance.estate.factory.XmlEstateRepositoryFactory" />
    <beans:bean
        id="descriptionValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.services.estate.validators.factory.DescriptionValidatorFactory" />
    <beans:bean
        id="descriptionAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.dto.assembler.factory.DescriptionAssemblerFactory" />
    <beans:bean
        id="estateValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.services.estate.validators.factory.EstateValidatorFactoryImpl" />
    <beans:bean
        id="estateAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.dto.assembler.factory.EstateAssemblerFactory" />
        
    <beans:bean
        id="estateSorter"
        class="ca.ulaval.glo4003.b6.housematch.domain.estate.EstateSorter"/>

    <beans:bean
        id="estateService"
        class="ca.ulaval.glo4003.b6.housematch.services.estate.EstatesService"
        scope="session"
    >
        <beans:constructor-arg
            name="estateValidatorFactory"
            ref="estateValidatorFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
    </beans:bean>

    <beans:bean
        id="descriptionCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.estate.DescriptionCorruptionVerificator"
        scope="session"
    >
        <beans:constructor-arg
            name="estateService"
            ref="estateService" />
    </beans:bean>

    <beans:bean
        id="estatesFetcher"
        class="ca.ulaval.glo4003.b6.housematch.services.estate.EstatesFetcher"
        scope="session"
    >
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
        <beans:constructor-arg
        	name="estateSorter"
        	ref="estateSorter" />
    </beans:bean>

    <beans:bean
        id="addressCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.estate.AddressCorruptionVerificator"
        scope="session" />

    <beans:bean
        id="estateCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.estate.EstateCorruptionVerificator"
        scope="session"
    >
        <beans:constructor-arg
            name="addressCorruptionVerificator"
            ref="addressCorruptionVerificator" />

        <beans:constructor-arg
            name="estateService"
            ref="estateService" />
    </beans:bean>


    <beans:bean
        id="sellerEstateController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SellerEstateController"
        scope="session"
    >
        <beans:constructor-arg
            name="estateCorruptionVerificator"
            ref="estateCorruptionVerificator" />
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
        <beans:constructor-arg
            name="estatesFetcher"
            ref="estatesFetcher" />
        <beans:constructor-arg
            name="descriptionCorruptionVerificator"
            ref="descriptionCorruptionVerificator" />
    </beans:bean>
    <beans:bean
        id="buyerSearchEstatesController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.BuyerSearchEstatesController"
        scope="session"
    >
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
    </beans:bean>

    <beans:bean
        id="loggedUser"
        class="ca.ulaval.glo4003.b6.housematch.domain.user.User"
        scope="session">
        <aop:scoped-proxy />
    </beans:bean>
        
    <beans:bean
        id="xmlElementReaderId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.XMLPersistence.XMLElementReader" />
        
    <beans:bean
        id="xmlElementWriterId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.XMLPersistence.XMLElementWriter" />

    <beans:bean
        id="xmlFileAccesserId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.XMLPersistence.XMLFileAccesser" />
	
	<beans:bean
        id="xmlFileEditorId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.XMLPersistence.XMLFileEditor">
        <beans:constructor-arg
            name="xmlElementReader"
            ref="xmlElementReaderId" />
        <beans:constructor-arg
            name="xmlElementWriter"
            ref="xmlElementWriterId" />
        <beans:constructor-arg
            name="xmlFileAccesser"
            ref="xmlFileAccesserId" />
    </beans:bean>
    
    <beans:bean
        id="persistenceDtoFactoryId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.PersistenceDtoFactory" />
        
    <beans:bean
        id="repositoryUserConverterId"
        class="ca.ulaval.glo4003.b6.housematch.persistance.user.converter.RepositoryUserConverter" />
          
    <beans:bean
        id="userRepository"
        class="ca.ulaval.glo4003.b6.housematch.persistance.user.XMLUserRepository">
        <beans:constructor-arg
            name="persistenceDtoFactory"
            ref="persistenceDtoFactoryId" />
        <beans:constructor-arg
            name="repositoryUserConverter"
            ref="repositoryUserConverterId" />
        <beans:constructor-arg
            name="xmlFileEditor"
            ref="xmlFileEditorId" />
    </beans:bean>

    <beans:bean
        id="userValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.services.user.validator.UserValidatorFactory" />

    <beans:bean
        id="userAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.dto.assembler.factory.UserAssemblerFactory" />

    <beans:bean
        id="userAuthorizationService"
        class="ca.ulaval.glo4003.b6.housematch.services.user.UserAuthorizationService" />

    <beans:bean
        id="mailBuilderFactory"
        class="ca.ulaval.glo4003.b6.housematch.messaging.MailBuilderFactory" />

    <beans:bean
        id="mailSenderFactory"
        class="ca.ulaval.glo4003.b6.housematch.messaging.MailSenderFactory" />
        
    <beans:bean
        id="mailSenderObserver"
        class="ca.ulaval.glo4003.b6.housematch.services.user.MailSenderObserver"
        scope="session">
        <beans:constructor-arg
            name="messageBuilderFactory"
            ref="mailBuilderFactory" />
        <beans:constructor-arg
            name="messageSenderFactory"
            ref="mailSenderFactory" />

    </beans:bean>

    <beans:bean
        id="activationService"
        class="ca.ulaval.glo4003.b6.housematch.services.user.ActivationService"
        scope="session" />


    <beans:bean
        id="userLoginService"
        class="ca.ulaval.glo4003.b6.housematch.services.user.UserLoginService"
        scope="session"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />

    </beans:bean>

    <beans:bean
        id="activationController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.ActivationController"
        scope="session"
    >

        <beans:constructor-arg
            name="activationService"
            ref="activationService" />

    </beans:bean>

    <beans:bean
        id="userSignupService"
        class="ca.ulaval.glo4003.b6.housematch.services.user.UserSignupService"
        scope="session"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="userValidatorFactory"
            ref="userValidatorFactory" />
        <beans:constructor-arg
            name="userAssemblerFactory"
            ref="userAssemblerFactory" />
        <beans:constructor-arg>
            <beans:list>
                <beans:ref bean="mailSenderObserver" />
            </beans:list>
        </beans:constructor-arg>

    </beans:bean>
    <beans:bean
        id="userFetcher"
        class="ca.ulaval.glo4003.b6.housematch.services.user.UserFetcher"
        scope="session"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
    </beans:bean>

    <beans:bean
        id="userLoginCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.user.UserLoginCorruptionVerificator"
        scope="session"
    >

        <beans:constructor-arg
            name="userLoginService"
            ref="userLoginService" />
    </beans:bean>


    <beans:bean
        id="userSignupCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.user.UserSignupCorruptionVerificator"
        scope="session"
    >
        <beans:constructor-arg
            name="userSignupService"
            ref="userSignupService" />
        <beans:constructor-arg
            name="contactInformationCorruptionVerificator"
            ref="contactInformationCorruptionVerificator" />

    </beans:bean>

    <beans:bean
        id="loginController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.LoginController"
        scope="session"
    >
        <beans:constructor-arg
            name="userLoginCorruptionVerificator"
            ref="userLoginCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="signupController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SignupController"
        scope="session"
    >
        <beans:constructor-arg
            name="userSignupCorruptionVerificator"
            ref="userSignupCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="logoutController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.LogoutController"
    >
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />

    </beans:bean>

    <beans:bean
        id="contactInformationCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.user.ContactInformationCorruptionVerificator" 
        scope="session"/>

    <beans:bean
        id="contactInformationAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.dto.assembler.factory.ContactInformationAssemblerFactory" />

    <beans:bean
        id="userProfilService"
        class="ca.ulaval.glo4003.b6.housematch.services.user.UserProfilService"
        scope="session"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="contactInformationAssemblerFactory"
            ref="contactInformationAssemblerFactory" />
        <beans:constructor-arg>
            <beans:list>
                <beans:ref bean="mailSenderObserver" />
            </beans:list>
        </beans:constructor-arg>

    </beans:bean>

    <beans:bean
        id="userProfilCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.anticorruption.user.UserProfilCorruptionVerificator"
        scope="session"
    >
        <beans:constructor-arg
            name="userProfilService"
            ref="userProfilService" />
        <beans:constructor-arg
            name="contactInformationCorruptionVerificator"
            ref="contactInformationCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="profilUserController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.ProfilUserController"
        scope="session"
    >
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
        <beans:constructor-arg
            name="userFetcher"
            ref="userFetcher" />
        <beans:constructor-arg
            name="userProfilCorruptionVerificator"
            ref="userProfilCorruptionVerificator" />
    </beans:bean>


</beans:beans>