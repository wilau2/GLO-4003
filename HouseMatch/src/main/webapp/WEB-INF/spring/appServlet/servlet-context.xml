<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/aop
    	http://www.springframework.org/schema/aop/spring-aop-3.1.xsd"
>

    <context:component-scan base-package="ca.ulaval.glo4003.b6.housematch" />
    <annotation-driven />

    <!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources/ 
        directory -->
    <resources
        mapping="/resources/**"
        location="/resources/" />

    <!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
    <beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <beans:property
            name="prefix"
            value="/WEB-INF/views/" />
        <beans:property
            name="suffix"
            value=".jsp" />
    </beans:bean>


    <beans:bean
        id="estateValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.dto.validators.factories.EstateValidatorFactoryImpl" />
    <beans:bean
        id="estateAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.domain.assembler.factory.EstateAssemblerFactory" />
    <beans:bean
        id="estateRepositoryFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.repository.factory.XmlEstateRepositoryFactory" />
    <beans:bean
        id="addressValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.dto.validators.factories.AddressValidatorFactoryImpl" />
    <beans:bean
        id="estateService"
        class="ca.ulaval.glo4003.b6.housematch.estates.services.EstatesService"
    >
        <beans:constructor-arg
            name="estateValidatorFactory"
            ref="estateValidatorFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="addressValidatorFactory"
            ref="addressValidatorFactory" />

    </beans:bean>
    <beans:bean
        id="addressCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.estates.anticorruption.AddressCorruptionVerificator" />

    <beans:bean
        id="estateCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.estates.anticorruption.EstateCorruptionVerificator"
    >
        <beans:constructor-arg
            name="addressCorruptionVerificator"
            ref="addressCorruptionVerificator" />

        <beans:constructor-arg
            name="estateService"
            ref="estateService" />
    </beans:bean>

    <beans:bean
        id="estatesFetcher"
        class="ca.ulaval.glo4003.b6.housematch.estates.services.EstatesFetcher"
    >

        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
    </beans:bean>

    <beans:bean
        id="estateConverter"
        class="ca.ulaval.glo4003.b6.housematch.web.converters.EstateConverter" />
    <beans:bean
        id="sellerEstateController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SellerEstateController"
    >
        <beans:constructor-arg
            name="estateConverter"
            ref="estateConverter" />
        <beans:constructor-arg
            name="estateCorruptionVerificator"
            ref="estateCorruptionVerificator" />
        <beans:constructor-arg
            name="estatesFetcher"
            ref="estatesFetcher" />
    </beans:bean>

    <beans:bean
        id="loggedUser"
        class="ca.ulaval.glo4003.b6.housematch.user.domain.User"
        scope="session"
    >
        <aop:scoped-proxy />
    </beans:bean>

    <beans:bean
        id="userRepository"
        class="ca.ulaval.glo4003.b6.housematch.user.repository.XMLUserRepository" />
    <beans:bean
        id="adminRepository"
        class="ca.ulaval.glo4003.b6.housematch.admin.repository.XMLAdminRepository" />
    <beans:bean
        id="userValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.user.dto.validators.UserValidatorFactory" />
    <beans:bean
        id="loginUserConverter"
        class="ca.ulaval.glo4003.b6.housematch.web.converters.LoginUserConverter" />
    <beans:bean
        id="loginUserService"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserLoginService"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="adminRepository"
            ref="adminRepository" />
        <beans:constructor-arg
            name="userValidatorFactory"
            ref="userValidatorFactory" />
    </beans:bean>

    <beans:bean
        id="userCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.user.anticorruption.UserLoginCorruptionVerificator"
    >
        <beans:constructor-arg
            name="loginUserService"
            ref="loginUserService" />
    </beans:bean>

    <beans:bean
        id="loginController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.LoginController"
    >
        <beans:constructor-arg
            name="loginUserConverter"
            ref="loginUserConverter" />
        <beans:constructor-arg
            name="userCorruptionVerificator"
            ref="userCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="signupController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SignupController"
    >
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
    </beans:bean>

</beans:beans>