<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/aop
    	http://www.springframework.org/schema/aop/spring-aop-3.1.xsd">

    <context:component-scan base-package="ca.ulaval.glo4003.b6.housematch" />
    <annotation-driven />

    <!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources/ 
        directory -->
    <resources
        mapping="/resources/**"
        location="/resources/" />

    <!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
    <beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <beans:property
            name="prefix"
            value="/WEB-INF/views/" />
        <beans:property
            name="suffix"
            value=".jsp" />
    </beans:bean>


    <beans:bean
        id="estateValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.dto.validators.factories.EstateValidatorFactoryImpl" />
    <beans:bean
        id="estateAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.domain.assembler.factory.EstateAssemblerFactory" />
    <beans:bean
        id="estateRepositoryFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.repository.factory.XmlEstateRepositoryFactory" />
    <beans:bean
        id="addressValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.dto.validators.factories.AddressValidatorFactoryImpl" />
    <beans:bean
        id="estateService"
        class="ca.ulaval.glo4003.b6.housematch.estates.services.EstatesService">
        <beans:constructor-arg
            name="estateValidatorFactory"
            ref="estateValidatorFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="addressValidatorFactory"
            ref="addressValidatorFactory" />
    </beans:bean>
    <beans:bean
        id="addressCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.estates.anticorruption.AddressCorruptionVerificator" />

    <beans:bean
        id="estateCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.estates.anticorruption.EstateCorruptionVerificator">
        <beans:constructor-arg
            name="addressCorruptionVerificator"
            ref="addressCorruptionVerificator" />

        <beans:constructor-arg
            name="estateService"
            ref="estateService" />
    </beans:bean>

    <beans:bean
        id="estatesFetcherFactory"
        class="ca.ulaval.glo4003.b6.housematch.estates.services.EstatesFetcherFactory" />
    <beans:bean
        id="sellerEstateController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SellerEstateController">
        <beans:constructor-arg
            name="estateCorruptionVerificator"
            ref="estateCorruptionVerificator" />
        <beans:constructor-arg
            name="estatesFetcherFactory"
            ref="estatesFetcherFactory" />
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
    </beans:bean>
    <beans:bean
        id="buyerSearchEstatesController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.BuyerSearchEstatesController">
        <beans:constructor-arg
            name="estatesFetcherFactory"
            ref="estatesFetcherFactory" />
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
        <beans:constructor-arg
            name="estateRepositoryFactory"
            ref="estateRepositoryFactory" />
        <beans:constructor-arg
            name="estateAssemblerFactory"
            ref="estateAssemblerFactory" />
    </beans:bean>

    <beans:bean
        id="loggedUser"
        class="ca.ulaval.glo4003.b6.housematch.user.domain.User"
        scope="session">
        <aop:scoped-proxy />
    </beans:bean>

    <beans:bean
        id="userRepository"
        class="ca.ulaval.glo4003.b6.housematch.user.repository.XMLUserRepository" />
    <beans:bean
        id="userValidatorFactory"
        class="ca.ulaval.glo4003.b6.housematch.user.dto.validators.factory.UserValidatorFactory" />
    <beans:bean
        id="userAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.user.domain.assembler.factory.UserAssemblerFactory" />
    <beans:bean
        id="loginUserConverter"
        class="ca.ulaval.glo4003.b6.housematch.web.converters.LoginUserConverter" />
    <beans:bean
        id="signupUserConverter"
        class="ca.ulaval.glo4003.b6.housematch.web.converters.SignupUserConverter" />
    <beans:bean
        id="userAuthorizationService"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserAuthorizationService" />
    <beans:bean
        id="profilUserConverter"
        class="ca.ulaval.glo4003.b6.housematch.web.converters.ProfilUserConverter" />
        
	<beans:bean 
		id="mailSenderObserver"
		class="ca.ulaval.glo4003.b6.housematch.user.services.observer.MailSenderObserver"/>
	
	<beans:bean
		id="activationService"
		class="ca.ulaval.glo4003.b6.housematch.user.services.ActivationService" />


    <beans:bean
        id="userLoginService"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserLoginService">

        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />

    </beans:bean>
    
	<beans:bean 
		id="activationController"
		class="ca.ulaval.glo4003.b6.housematch.web.controllers.ActivationController">
	
		<beans:constructor-arg 
			name="activationService"
			ref="activationService" />
			
	</beans:bean>

    <beans:bean
        id="userSignupService"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserSignupService">
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="userValidatorFactory"
            ref="userValidatorFactory" />
        <beans:constructor-arg
            name="userAssemblerFactory"
            ref="userAssemblerFactory" />
        <beans:constructor-arg> 
			<beans:list>
				<beans:ref bean="mailSenderObserver"/>
			</beans:list>
		</beans:constructor-arg>

    </beans:bean>
    <beans:bean
        id="userFetcher"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserFetcher">
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
    </beans:bean>

    <beans:bean
        id="userLoginCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.user.anticorruption.UserLoginCorruptionVerificator">

        <beans:constructor-arg
            name="userLoginService"
            ref="userLoginService" />
    </beans:bean>


    <beans:bean
        id="userSignupCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.user.anticorruption.UserSignupCorruptionVerificator">
        <beans:constructor-arg
            name="userSignupService"
            ref="userSignupService" />
        <beans:constructor-arg
            name="contactInformationCorruptionVerificator"
            ref="contactInformationCorruptionVerificator" />

    </beans:bean>

    <beans:bean
        id="loginController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.LoginController">
        <beans:constructor-arg
            name="loginUserConverter"
            ref="loginUserConverter" />
        <beans:constructor-arg
            name="userLoginCorruptionVerificator"
            ref="userLoginCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="signupController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.SignupController">
        <beans:constructor-arg
            name="signupUserConverter"
            ref="signupUserConverter" />
        <beans:constructor-arg
            name="userSignupCorruptionVerificator"
            ref="userSignupCorruptionVerificator" />
        <beans:constructor-arg
            name="userLoginService"
            ref="userLoginService" />
    </beans:bean>

    <beans:bean
        id="logoutController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.LogoutController">
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />

    </beans:bean>

    <beans:bean
        id="contactInformationCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.user.anticorruption.ContactInformationCorruptionVerificator" />

    <beans:bean
        id="contactInformationAssemblerFactory"
        class="ca.ulaval.glo4003.b6.housematch.user.domain.assembler.factory.ContactInformationAssemblerFactory" />

    <beans:bean
        id="userProfilService"
        class="ca.ulaval.glo4003.b6.housematch.user.services.UserProfilService">
        <beans:constructor-arg
            name="userRepository"
            ref="userRepository" />
        <beans:constructor-arg
            name="contactInformationAssemblerFactory"
            ref="contactInformationAssemblerFactory" />
        <beans:constructor-arg> 
			<beans:list>
				<beans:ref bean="mailSenderObserver"/>
			</beans:list>
		</beans:constructor-arg>

    </beans:bean>

    <beans:bean
        id="userProfilCorruptionVerificator"
        class="ca.ulaval.glo4003.b6.housematch.user.anticorruption.UserProfilCorruptionVerificator">
        <beans:constructor-arg
            name="userProfilService"
            ref="userProfilService" />
        <beans:constructor-arg
            name="contactInformationCorruptionVerificator"
            ref="contactInformationCorruptionVerificator" />
    </beans:bean>

    <beans:bean
        id="profilUserController"
        class="ca.ulaval.glo4003.b6.housematch.web.controllers.ProfilUserController">
        <beans:constructor-arg
            name="userAuthorizationService"
            ref="userAuthorizationService" />
        <beans:constructor-arg
            name="profilUserConverter"
            ref="profilUserConverter" />
        <beans:constructor-arg
            name="userFetcher"
            ref="userFetcher" />
        <beans:constructor-arg
            name="userProfilCorruptionVerificator"
            ref="userProfilCorruptionVerificator" />
    </beans:bean>


</beans:beans>